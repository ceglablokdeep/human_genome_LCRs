####This is the main script for human genetics repeats paper########
##1 Dec, 2022#######
##1. Download human protein sequences from Gencode Release 42 (GRCh38.p13)
wget https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_42/gencode.v42.pc_transcripts.fa.gz
##I have downloaded Protein-coding transcript sequences
##2. Download the translations files as we are interested in the protein repeats
wget https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_42/gencode.v42.pc_translations.fa.gz
awk -F"|" '{print $1}' gencode.v42.pc_translations.fa > gencode.v42_translations_oneheader.fa
wget  https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_42/gencode.v42.chr_patch_hapl_scaff.annotation.gtf.gz
#Create a composition file to detect protein repeats in the protein sequences
CompositionMaker gencode.v42_translations_oneheader.fa
fLPS2 -c gencode.v42_translations_oneheader.fa.COMPOSITION gencode.v42_translations_oneheader.fa > gencode.v42_flpsout_withcomposition
awk '$7>3 && $9 !~ /X/ && ($7/(($6-$5)+1)) > 0.5 && length($9)<5{print $0}' OFS='\t' gencode.v42_flpsout_withcomposition|sed -e 's/{//g' -e 's/}//g' > gencode.v42_morethanfifty_repeats
##creatng bed file to extract the sequences from the fasta file
##bedtools require to subtract one from the initial position to include that nucleotide/amino acid
awk '{print $1,$5-1,$6}' OFS="\t" gencode.v42_morethanfifty_repeats > input.bed
bedtools getfasta -fi gencode.v42_translations_oneheader.fa -bed input.bed -tab|awk '{print $1,$2,20,20}'|sed 's/ /\t/g' >  input_pogo.txt
PoGo -fasta gencode.v42.pc_translations.fa -gtf gencode.v42.chr_patch_hapl_scaff.annotation.gtf -in input_pogo.txt > repeats_genomic.bed
##49976 input_pogo.gct
##input_pogo.gct is the file with mapped coordinates
cut -f1,2 input_pogo.gct|awk -F "ENSG" 'NF==3{print $0}'|sed -e 's/"//g' -e 's/|/\t/g' -e 's/@//g' -e 's/\./\t/1'|awk '$1==$3{print $4,$1,$2}' OFS="\t"|grep -v ","|sed -e 's/:/\t/g' -e 's/-/\t/g' -e 's/chr//g'|sort -k1,1 -k2n,2|sed 's/\t$//'|bedtools merge -c 4,5 -o distinct,distinct -i stdin > flps_detected_single_chronly_exon_repeats.txt
##49968 single gene mapped
##i.e. 49976 - 49968 = 8 are multimapped
awk '{print $6,$7,$8,$11,$12}' OFS="\t" repeats_ucsc_grch38|sed '1d'|sort -k1,1 -k2n,2|bedtools merge -c 4,5 -o distinct,distinct -i stdin > ucsc_repeats.bed
##4211495 ucsc_repeats.bed
##ucsc_repeats.bed contains both exonic and non-geneic repeats
awk '{print "chr"$0}' flps_detected_single_chronly_exon_repeats.txt > flps_detected_single_chronly_exon_repeats_chr.txt
##11060 flps_detected_single_chronly_exon_repeats_chr.txt


##I am keeping these output files here.
